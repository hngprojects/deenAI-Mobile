name: Android CD (Continuous Deployment)

# Trigger CD only on version tags and manual workflow dispatch
# This ensures controlled releases with proper versioning
on:
  push:
    tags:
      - 'v*.*.*'  # Matches v1.0.0, v2.1.3, etc.
  workflow_dispatch:
    inputs:
      release_type:
        description: 'Release type'
        required: true
        type: choice
        options:
          - production
          - staging
          - internal
        default: 'internal'

# Prevent concurrent deployments to avoid conflicts
concurrency:
  group: android-cd-${{ github.ref }}
  cancel-in-progress: false

jobs:
  # =============================================================================
  # PRE-DEPLOYMENT VALIDATION
  # Runs all CI checks before building release artifacts
  # =============================================================================
  pre-deployment-checks:
    name: Pre-Deployment Validation
    runs-on: ubuntu-latest
    
    outputs:
      version: ${{ steps.version.outputs.version }}
      build_number: ${{ steps.version.outputs.build_number }}
      version_code: ${{ steps.version.outputs.version_code }}
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Fetch all history for proper versioning

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20.x'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      # Run linting to ensure code quality
      - name: Run ESLint
        run: npm run lint

      # Run TypeScript type checking
      - name: TypeScript type check
        run: npx tsc --noEmit

      # Run tests to ensure functionality
      - name: Run tests
        run: npm test

      # Extract version information from tag or package.json
      - name: Extract version information
        id: version
        run: |
          if [[ "${{ github.ref_type }}" == "tag" ]]; then
            VERSION=${GITHUB_REF#refs/tags/v}
          else
            VERSION=$(node -p "require('./package.json').version")
          fi
          
          BUILD_NUMBER=${{ github.run_number }}
          
          # Convert semantic version to version code (e.g., 1.2.3 -> 10203)
          # This ensures version codes are monotonically increasing
          VERSION_CODE=$(echo $VERSION | awk -F. '{printf "%d%02d%02d", $1, $2, $3}')
          
          echo "version=$VERSION" >> $GITHUB_OUTPUT
          echo "build_number=$BUILD_NUMBER" >> $GITHUB_OUTPUT
          echo "version_code=$VERSION_CODE" >> $GITHUB_OUTPUT
          
          echo "ðŸ“¦ Deploying version: $VERSION"
          echo "ðŸ”¢ Build number: $BUILD_NUMBER"
          echo "ðŸ“± Version code: $VERSION_CODE"

  # =============================================================================
  # BUILD SIGNED APK
  # Creates signed APK for direct distribution (sideloading, testing, etc.)
  # APK is universal but larger in size than AAB
  # =============================================================================
  build-apk:
    name: Build Signed APK
    runs-on: ubuntu-latest
    needs: [pre-deployment-checks]
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20.x'
          cache: 'npm'

      # Setup Java 17 for React Native 0.81.5
      - name: Setup Java 17
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'
          cache: 'gradle'

      - name: Install dependencies
        run: npm ci

      # Generate Android native project using Expo prebuild
      # No EXPO_TOKEN required - uses local expo-cli from node_modules
      - name: Generate Android native project
        run: |
          echo "ðŸ“¦ Generating Android project with Expo prebuild..."
          npx expo prebuild --platform android --clean --skip-dependency-update react-native,react
          
          echo "âœ… Android project generated successfully"

      # Update version information in Android project
      - name: Update Android version information
        run: |
          VERSION="${{ needs.pre-deployment-checks.outputs.version }}"
          VERSION_CODE="${{ needs.pre-deployment-checks.outputs.version_code }}"
          
          # Update version in gradle.properties
          echo "" >> android/gradle.properties
          echo "# Version information from CI/CD" >> android/gradle.properties
          echo "VERSION_NAME=$VERSION" >> android/gradle.properties
          echo "VERSION_CODE=$VERSION_CODE" >> android/gradle.properties
          
          echo "âœ… Updated version to $VERSION (code: $VERSION_CODE)"

      # Update build.gradle to use version from gradle.properties
      - name: Configure build.gradle for versioning
        run: |
          # Backup original build.gradle
          cp android/app/build.gradle android/app/build.gradle.bak
          
          # Add version code and name from gradle.properties
          cat > /tmp/version_config.gradle << 'EOF'
          
          // Read version from gradle.properties
          def versionName = project.hasProperty('VERSION_NAME') ? VERSION_NAME : "1.0.0"
          def versionCode = project.hasProperty('VERSION_CODE') ? VERSION_CODE.toInteger() : 1
          
          android {
              defaultConfig {
                  versionCode versionCode
                  versionName versionName
              }
          }
          EOF
          
          # Append to build.gradle
          cat /tmp/version_config.gradle >> android/app/build.gradle
          
          echo "âœ… Configured build.gradle for dynamic versioning"

      # Decode and setup keystore for signing
      # Keystore must be base64 encoded and stored in secrets
      - name: Setup Android keystore
        run: |
          echo "${{ secrets.ANDROID_KEYSTORE_BASE64 }}" | base64 --decode > android/app/release.keystore
          echo "âœ… Keystore decoded and placed in android/app/"

      # Create keystore.properties file for Gradle signing configuration
      - name: Create keystore properties
        run: |
          cat > android/keystore.properties << EOF
          storePassword=${{ secrets.ANDROID_KEYSTORE_PASSWORD }}
          keyPassword=${{ secrets.ANDROID_KEY_PASSWORD }}
          keyAlias=${{ secrets.ANDROID_KEY_ALIAS }}
          storeFile=release.keystore
          EOF
          
          echo "âœ… Created keystore.properties"

      # Update build.gradle to use keystore.properties for signing
      - name: Configure signing in build.gradle
        run: |
          cat > /tmp/signing_config.gradle << 'EOF'
          
          // Load keystore properties
          def keystorePropertiesFile = rootProject.file("keystore.properties")
          def keystoreProperties = new Properties()
          if (keystorePropertiesFile.exists()) {
              keystoreProperties.load(new FileInputStream(keystorePropertiesFile))
          }
          
          android {
              signingConfigs {
                  release {
                      if (keystorePropertiesFile.exists()) {
                          storeFile file(keystoreProperties['storeFile'])
                          storePassword keystoreProperties['storePassword']
                          keyAlias keystoreProperties['keyAlias']
                          keyPassword keystoreProperties['keyPassword']
                      }
                  }
              }
              buildTypes {
                  release {
                      signingConfig signingConfigs.release
                      minifyEnabled true
                      proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
                  }
              }
          }
          EOF
          
          # Insert signing config into build.gradle
          cat /tmp/signing_config.gradle >> android/app/build.gradle
          
          echo "âœ… Configured signing in build.gradle"

      # Cache Gradle dependencies
      - name: Cache Gradle dependencies
        uses: actions/cache@v4
        with:
          path: |
            ~/.gradle/caches
            ~/.gradle/wrapper
          key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}
          restore-keys: |
            ${{ runner.os }}-gradle-

      # Grant execute permissions to gradlew
      - name: Make gradlew executable
        run: chmod +x android/gradlew

      # Build signed release APK using Gradle
      - name: Build release APK
        working-directory: android
        run: |
          ./gradlew assembleRelease --stacktrace --no-daemon
          echo "âœ… APK build completed"

      # Verify APK was created and is signed
      - name: Verify APK signature
        run: |
          APK_PATH="android/app/build/outputs/apk/release/app-release.apk"
          
          if [ ! -f "$APK_PATH" ]; then
            echo "âŒ APK not found at $APK_PATH"
            exit 1
          fi
          
          echo "âœ… APK found at $APK_PATH"
          
          # Check APK size
          SIZE=$(stat -c%s "$APK_PATH")
          SIZE_MB=$((SIZE / 1024 / 1024))
          echo "ðŸ“¦ APK size: ${SIZE_MB}MB"
          
          # Verify APK signature using apksigner
          echo "ðŸ” Verifying APK signature..."
          $ANDROID_HOME/build-tools/*/apksigner verify --verbose "$APK_PATH"
          
          echo "âœ… APK signature verified successfully"

      # Rename APK with version information
      - name: Rename APK with version
        run: |
          VERSION="${{ needs.pre-deployment-checks.outputs.version }}"
          BUILD="${{ needs.pre-deployment-checks.outputs.build_number }}"
          
          OLD_PATH="android/app/build/outputs/apk/release/app-release.apk"
          NEW_PATH="android/app/build/outputs/apk/release/deenai-mobile-v${VERSION}-build${BUILD}.apk"
          
          mv "$OLD_PATH" "$NEW_PATH"
          echo "APK_PATH=$NEW_PATH" >> $GITHUB_ENV
          
          echo "âœ… Renamed APK to: deenai-mobile-v${VERSION}-build${BUILD}.apk"

      # Upload signed APK as downloadable artifact
      - name: Upload signed APK
        uses: actions/upload-artifact@v4
        with:
          name: signed-apk-v${{ needs.pre-deployment-checks.outputs.version }}
          path: ${{ env.APK_PATH }}
          retention-days: 90  # Keep for 90 days

      # Clean up sensitive files
      - name: Cleanup keystore
        if: always()
        run: |
          rm -f android/app/release.keystore
          rm -f android/keystore.properties
          echo "âœ… Cleaned up sensitive files"

  # =============================================================================
  # BUILD SIGNED AAB (Android App Bundle)
  # Creates signed AAB for Google Play Store distribution
  # AAB is optimized and required for Play Store uploads
  # =============================================================================
  build-aab:
    name: Build Signed AAB
    runs-on: ubuntu-latest
    needs: [pre-deployment-checks]
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20.x'
          cache: 'npm'

      - name: Setup Java 17
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'
          cache: 'gradle'

      - name: Install dependencies
        run: npm ci

      # Generate Android native project
      - name: Generate Android native project
        run: |
          echo "ðŸ“¦ Generating Android project with Expo prebuild..."
          npx expo prebuild --platform android --clean --skip-dependency-update react-native,react
          echo "âœ… Android project generated"

      # Update version information
      - name: Update Android version information
        run: |
          VERSION="${{ needs.pre-deployment-checks.outputs.version }}"
          VERSION_CODE="${{ needs.pre-deployment-checks.outputs.version_code }}"
          
          echo "" >> android/gradle.properties
          echo "VERSION_NAME=$VERSION" >> android/gradle.properties
          echo "VERSION_CODE=$VERSION_CODE" >> android/gradle.properties

      # Configure build.gradle for versioning
      - name: Configure build.gradle for versioning
        run: |
          cat > /tmp/version_config.gradle << 'EOF'
          
          def versionName = project.hasProperty('VERSION_NAME') ? VERSION_NAME : "1.0.0"
          def versionCode = project.hasProperty('VERSION_CODE') ? VERSION_CODE.toInteger() : 1
          
          android {
              defaultConfig {
                  versionCode versionCode
                  versionName versionName
              }
          }
          EOF
          
          cat /tmp/version_config.gradle >> android/app/build.gradle

      # Setup keystore for AAB signing
      - name: Setup Android keystore
        run: |
          echo "${{ secrets.ANDROID_KEYSTORE_BASE64 }}" | base64 --decode > android/app/release.keystore

      - name: Create keystore properties
        run: |
          cat > android/keystore.properties << EOF
          storePassword=${{ secrets.ANDROID_KEYSTORE_PASSWORD }}
          keyPassword=${{ secrets.ANDROID_KEY_PASSWORD }}
          keyAlias=${{ secrets.ANDROID_KEY_ALIAS }}
          storeFile=release.keystore
          EOF

      # Configure signing in build.gradle
      - name: Configure signing in build.gradle
        run: |
          cat > /tmp/signing_config.gradle << 'EOF'
          
          def keystorePropertiesFile = rootProject.file("keystore.properties")
          def keystoreProperties = new Properties()
          if (keystorePropertiesFile.exists()) {
              keystoreProperties.load(new FileInputStream(keystorePropertiesFile))
          }
          
          android {
              signingConfigs {
                  release {
                      if (keystorePropertiesFile.exists()) {
                          storeFile file(keystoreProperties['storeFile'])
                          storePassword keystoreProperties['storePassword']
                          keyAlias keystoreProperties['keyAlias']
                          keyPassword keystoreProperties['keyPassword']
                      }
                  }
              }
              buildTypes {
                  release {
                      signingConfig signingConfigs.release
                      minifyEnabled true
                      proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
                  }
              }
          }
          EOF
          
          cat /tmp/signing_config.gradle >> android/app/build.gradle

      # Cache Gradle dependencies
      - name: Cache Gradle dependencies
        uses: actions/cache@v4
        with:
          path: |
            ~/.gradle/caches
            ~/.gradle/wrapper
          key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}
          restore-keys: |
            ${{ runner.os }}-gradle-

      - name: Make gradlew executable
        run: chmod +x android/gradlew

      # Build signed release AAB (Android App Bundle) using Gradle
      - name: Build release AAB
        working-directory: android
        run: |
          ./gradlew bundleRelease --stacktrace --no-daemon
          echo "âœ… AAB build completed"

      # Verify AAB was created and is properly signed
      - name: Verify AAB
        run: |
          AAB_PATH="android/app/build/outputs/bundle/release/app-release.aab"
          
          if [ ! -f "$AAB_PATH" ]; then
            echo "âŒ AAB not found at $AAB_PATH"
            exit 1
          fi
          
          echo "âœ… AAB found at $AAB_PATH"
          
          # Check AAB size
          SIZE=$(stat -c%s "$AAB_PATH")
          SIZE_MB=$((SIZE / 1024 / 1024))
          echo "ðŸ“¦ AAB size: ${SIZE_MB}MB"
          
          # AAB signature verification
          echo "ðŸ” Verifying AAB structure..."
          unzip -l "$AAB_PATH" | head -20
          
          echo "âœ… AAB structure verified"

      # Rename AAB with version information
      - name: Rename AAB with version
        run: |
          VERSION="${{ needs.pre-deployment-checks.outputs.version }}"
          BUILD="${{ needs.pre-deployment-checks.outputs.build_number }}"
          
          OLD_PATH="android/app/build/outputs/bundle/release/app-release.aab"
          NEW_PATH="android/app/build/outputs/bundle/release/deenai-mobile-v${VERSION}-build${BUILD}.aab"
          
          mv "$OLD_PATH" "$NEW_PATH"
          echo "AAB_PATH=$NEW_PATH" >> $GITHUB_ENV
          
          echo "âœ… Renamed AAB to: deenai-mobile-v${VERSION}-build${BUILD}.aab"

      # Upload signed AAB as downloadable artifact
      - name: Upload signed AAB
        uses: actions/upload-artifact@v4
        with:
          name: signed-aab-v${{ needs.pre-deployment-checks.outputs.version }}
          path: ${{ env.AAB_PATH }}
          retention-days: 90

      # Generate and upload mapping file for crash reporting
      # ProGuard mapping file is essential for deobfuscating crash reports
      - name: Upload ProGuard mapping file
        uses: actions/upload-artifact@v4
        with:
          name: mapping-v${{ needs.pre-deployment-checks.outputs.version }}
          path: android/app/build/outputs/mapping/release/mapping.txt
          retention-days: 365  # Keep mapping files for 1 year
        continue-on-error: true  # Don't fail if mapping file doesn't exist

      # Clean up sensitive files
      - name: Cleanup keystore
        if: always()
        run: |
          rm -f android/app/release.keystore
          rm -f android/keystore.properties

  # =============================================================================
  # E2E TESTING ON RELEASE BUILD
  # Tests the actual signed release APK before distribution
  # Uncomment when E2E tests are ready
  # =============================================================================
  # e2e-release-tests:
  #   name: E2E Tests on Release APK
  #   runs-on: ubuntu-latest
  #   needs: [build-apk]
  #   
  #   steps:
  #     - name: Checkout repository
  #       uses: actions/checkout@v4
  #
  #     # Download the signed release APK
  #     - name: Download release APK
  #       uses: actions/download-artifact@v4
  #       with:
  #         name: signed-apk-v${{ needs.pre-deployment-checks.outputs.version }}
  #         path: ./app
  #
  #     # Install Maestro for E2E testing
  #     - name: Install Maestro
  #       run: |
  #         curl -Ls "https://get.maestro.mobile.dev" | bash
  #         echo "${HOME}/.maestro/bin" >> $GITHUB_PATH
  #
  #     # Run critical E2E smoke tests on release build
  #     - name: Run E2E smoke tests
  #       uses: mobile-dev-inc/action-maestro-cloud@v1
  #       with:
  #         api-key: ${{ secrets.MAESTRO_CLOUD_API_KEY }}
  #         app-file: ./app/deenai-mobile-*.apk
  #         flows: .maestro/smoke/
  #
  #     # Upload test results
  #     - name: Upload E2E test results
  #       if: always()
  #       uses: actions/upload-artifact@v4
  #       with:
  #         name: e2e-release-results
  #         path: ~/.maestro/tests/
  #         retention-days: 30

  # =============================================================================
  # CREATE GITHUB RELEASE
  # Creates a GitHub release with APK and AAB as downloadable assets
  # =============================================================================
  create-release:
    name: Create GitHub Release
    runs-on: ubuntu-latest
    needs: [pre-deployment-checks, build-apk, build-aab]
    if: startsWith(github.ref, 'refs/tags/')
    
    permissions:
      contents: write  # Required to create releases
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      # Download APK artifact
      - name: Download APK
        uses: actions/download-artifact@v4
        with:
          name: signed-apk-v${{ needs.pre-deployment-checks.outputs.version }}
          path: ./artifacts/apk

      # Download AAB artifact
      - name: Download AAB
        uses: actions/download-artifact@v4
        with:
          name: signed-aab-v${{ needs.pre-deployment-checks.outputs.version }}
          path: ./artifacts/aab

      # Download ProGuard mapping file
      - name: Download mapping file
        uses: actions/download-artifact@v4
        with:
          name: mapping-v${{ needs.pre-deployment-checks.outputs.version }}
          path: ./artifacts/mapping
        continue-on-error: true

      # Generate release notes from commits
      - name: Generate release notes
        id: release_notes
        run: |
          VERSION="${{ needs.pre-deployment-checks.outputs.version }}"
          BUILD="${{ needs.pre-deployment-checks.outputs.build_number }}"
          VERSION_CODE="${{ needs.pre-deployment-checks.outputs.version_code }}"
          
          cat > release_notes.md << EOF
          # ðŸ¤– DeenAI Mobile Android v${VERSION} (Build ${BUILD})
          
          ## ðŸ“¦ Downloads
          - **APK**: For direct installation and testing
          - **AAB**: For Google Play Store upload
          - **Mapping**: ProGuard mapping file for crash analysis
          
          ## ðŸ”§ Build Information
          - **Version**: ${VERSION}
          - **Build Number**: ${BUILD}
          - **Version Code**: ${VERSION_CODE}
          - **Commit**: ${GITHUB_SHA:0:7}
          - **Built**: $(date -u +'%Y-%m-%d %H:%M:%S UTC')
          - **Built With**: Standard React Native/Android tools (no Expo EAS dependency)
          
          ## ðŸ“ Changes
          $(git log --pretty=format:"- %s" $(git describe --tags --abbrev=0 HEAD^)..HEAD 2>/dev/null || echo "- Initial release")
          
          ## âš™ï¸ Technical Details
          - React Native: 0.81.5
          - Expo SDK: ~54.0.23 (prebuild only, no runtime dependency)
          - Minimum SDK: Check app-level build.gradle
          - Java: 17
          - Gradle: Wrapper version in project
          
          ---
          
          ## ðŸ“² Installation Instructions for APK:
          
          1. **Enable Unknown Sources**
             - Go to Settings > Security
             - Enable "Install from Unknown Sources" or "Unknown Sources"
             
          2. **Download & Install**
             - Download the APK file
             - Open the downloaded file
             - Follow installation prompts
          
          ## ðŸš€ Play Store Upload Instructions for AAB:
          
          1. Go to [Google Play Console](https://play.google.com/console)
          2. Select your app
          3. Navigate to Release > Production (or Testing tracks)
          4. Create new release
          5. Upload the AAB file
          6. Upload the mapping.txt file for crash reporting
          7. Complete release details and submit
          
          ---
          
          **Note**: This build uses standard React Native/Android build tools with Expo prebuild for project generation.
          EOF
          
          echo "notes_file=release_notes.md" >> $GITHUB_OUTPUT

      # Create GitHub release with artifacts
      - name: Create GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          name: DeenAI Mobile Android v${{ needs.pre-deployment-checks.outputs.version }}
          body_path: release_notes.md
          draft: false
          prerelease: ${{ contains(github.ref, 'alpha') || contains(github.ref, 'beta') || contains(github.ref, 'rc') }}
          files: |
            ./artifacts/apk/*.apk
            ./artifacts/aab/*.aab
            ./artifacts/mapping/mapping.txt
          token: ${{ secrets.GITHUB_TOKEN }}

  # =============================================================================
  # DEPLOY TO GOOGLE PLAY STORE (INTERNAL TRACK)
  # Automatically uploads AAB to Play Store Internal Testing track
  # Uncomment when ready for Play Store distribution
  # =============================================================================
  # deploy-play-store:
  #   name: Deploy to Play Store
  #   runs-on: ubuntu-latest
  #   needs: [pre-deployment-checks, build-aab]
  #   if: github.event.inputs.release_type == 'production' || github.event.inputs.release_type == 'staging'
  #   
  #   steps:
  #     - name: Checkout repository
  #       uses: actions/checkout@v4
  #
  #     # Download the signed AAB
  #     - name: Download AAB
  #       uses: actions/download-artifact@v4
  #       with:
  #         name: signed-aab-v${{ needs.pre-deployment-checks.outputs.version }}
  #         path: ./artifacts/aab
  #
  #     # Upload to Google Play Store
  #     # Requires service account JSON in secrets
  #     - name: Upload to Play Store
  #       uses: r0adkll/upload-google-play@v1
  #       with:
  #         serviceAccountJsonPlainText: ${{ secrets.PLAY_STORE_SERVICE_ACCOUNT_JSON }}
  #         packageName: com.deenai.mobile  # Replace with your package name
  #         releaseFiles: ./artifacts/aab/*.aab
  #         track: ${{ github.event.inputs.release_type == 'production' && 'production' || 'internal' }}
  #         status: ${{ github.event.inputs.release_type == 'production' && 'completed' || 'draft' }}
  #         inAppUpdatePriority: 2
  #         whatsNewDirectory: ./whatsnew/  # Optional: Release notes per language
  #         mappingFile: ./artifacts/mapping/mapping.txt

  # =============================================================================
  # NOTIFY DEPLOYMENT
  # Sends deployment notifications to Slack/Discord/Email
  # =============================================================================
  notify-deployment:
    name: Notify Deployment Status
    runs-on: ubuntu-latest
    needs: [pre-deployment-checks, build-apk, build-aab, create-release]
    if: always()
    
    steps:
      # Send Slack notification (uncomment and configure when ready)
      # - name: Send Slack notification
      #   uses: slackapi/slack-github-action@v1
      #   with:
      #     webhook: ${{ secrets.SLACK_WEBHOOK_URL }}
      #     webhook-type: incoming-webhook
      #     payload: |
      #       {
      #         "text": "ðŸš€ DeenAI Mobile Android Deployment",
      #         "blocks": [
      #           {
      #             "type": "section",
      #             "text": {
      #               "type": "mrkdwn",
      #               "text": "*DeenAI Mobile Android v${{ needs.pre-deployment-checks.outputs.version }}* has been deployed!\n*Status:* ${{ needs.create-release.result }}\n*Build:* #${{ needs.pre-deployment-checks.outputs.build_number }}\n*Version Code:* ${{ needs.pre-deployment-checks.outputs.version_code }}"
      #             }
      #           }
      #         ]
      #       }

      # Alternative: Discord webhook notification
      # - name: Send Discord notification
      #   uses: sarisia/actions-status-discord@v1
      #   if: always()
      #   with:
      #     webhook: ${{ secrets.DISCORD_WEBHOOK }}
      #     title: "DeenAI Mobile Android Deployment"
      #     description: |
      #       Version: ${{ needs.pre-deployment-checks.outputs.version }}
      #       Build: ${{ needs.pre-deployment-checks.outputs.build_number }}
      #       Version Code: ${{ needs.pre-deployment-checks.outputs.version_code }}
      #       Status: ${{ needs.create-release.result }}
      #     color: ${{ needs.create-release.result == 'success' && '0x00FF00' || '0xFF0000' }}

      - name: Deployment summary
        run: |
          echo "ðŸŽ‰ Android Deployment completed for v${{ needs.pre-deployment-checks.outputs.version }}"
          echo "ðŸ“¦ APK and AAB artifacts are available for download"
          echo "ðŸ”¢ Version Code: ${{ needs.pre-deployment-checks.outputs.version_code }}"
          echo "ðŸ”— Check the Releases page for download links"
          echo ""
          echo "Build Method: Standard React Native/Android (Expo prebuild for project generation)"